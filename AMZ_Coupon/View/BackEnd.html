<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>Product App</title>
    <link rel="stylesheet" href="../View/Home.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
          crossorigin="anonymous">
</head>

<body>

    <div class="header">
        <!--標題bar-->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03"
                    aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="#">Navbar</a>

            <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
                <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" href="#">Disabled</a>
                    </li>
                </ul>
                <form class="form-inline my-2 my-lg-0"></form>
            </div>
        </nav>
    </div>
    <div class="container">
        <!--新增產品-->
        <div class="row">
            <div class="col-12">


                <div class="form-group">
                    <label for="">產品名稱</label>
                    <input type="text"
                           class="form-control" name="" id="ProductName" aria-describedby="helpId" placeholder="">
                </div>
                <div class="form-group">
                    <label for="">Coupon代碼</label>
                    <input type="text"
                           class="form-control" name="" id="ProductCoupon" aria-describedby="helpId" placeholder="">
                </div>
                <div class="form-group">
                    <label for="">價格</label>
                    <input type="number"
                           class="form-control" name="" id="ProductPrice" aria-describedby="helpId" placeholder="">
                </div>
                <div class="form-group">
                    <label for="">折扣(?% off)</label>
                    <input type="number"
                           class="form-control" name="" id="ProductDiscount" aria-describedby="helpId" placeholder="">
                </div>
                <div class="form-group">
                    <label for="">優惠期間(開始)</label>
                    <input type="datetime"
                           class="form-control" name="" id="ProductStart" aria-describedby="helpId" placeholder="">
                </div>
                <div class="form-group">
                    <label for="">優惠期間(結束)</label>
                    <input type="datetime"
                           class="form-control" name="" id="ProductEnd" aria-describedby="helpId" placeholder="">
                </div>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
                <a name="" id="saveProductInfo" class="btn btn-success">儲存</a>
            </div>
        </div>

        <!--全部產品資訊-->
        <div class="row">
            <div class="col-12">
                <div>
                    <h2>All Products</h2>
                    <ul id="products" />
                </div>
            </div>
        </div>




    </div>
    <div class="footer">

    </div>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>



    <script>
        var uri = 'p/api/product';
        var uri2 = 'p/api/main';



        $(document).ready(function () {

            $("#saveProductInfo").on('click', function () {
                SaveProductInfo();
            });
            // Send an AJAX request
            $.getJSON(uri2 +'/GetAllProducts/')
                .done(function (data) {
                    console.log('data', data);
                    // On success, 'data' contains a list of products.
                    $.each(data, function (key, item) {
                        // Add a list item for the product.

                        $('<li>', { text: formatItem(item) }).appendTo($('#products'));
                    });
                });
        });

        function formatItem(item) {
            return item.ProductName + ': $' + item.Price + '使用折價券後 : ' + item.Discount * item.Price;
        }



        function getUrlVars() {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }

        function SaveProductInfo() {
            var _discount = $("#ProductDiscount").val() / 100;

            var json = new Array();
            json.push({
                "ProductName": $("#ProductName").val(),
                "PCoupon": $("#ProductCoupon").val(),
                "Price": $("#ProductPrice").val(),
                "Discount": _discount,
                "StartTime": $("#ProductStart").val(),
                "EndTime": $("#ProductEnd").val()
            });

            console.log('json is : ', json);
            $.ajax({
                url: uri + '/PostProductInfo/' + json,
                data: JSON.stringify(json),
                type: "POST",
                contentType: "application/json",
                success: function (result) {
                    console.log('success result : ', result);
                },
                error: function (er) {

                    BackErr(er);
                }

            });
        }




    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
            crossorigin="anonymous"></script>

</body>

</html>